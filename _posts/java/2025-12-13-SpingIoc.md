---
layout:     post
title:      "手搓Spring Ioc ? "
subtitle:   " \"成为J佬的一天\""
date:       2025-12-13 12:00:00
author:     "HZY"
header-img: "img/java/1.png"
catalog: true
tags:
    - Java
---

## 写在前面
本章节起始于研究java核心技术卷，不知不觉发现已经有很多特性能够支持自己去进行一些创造，比如说，我可以实现Ioc整个流程，这便是反射的用武之地
再比如说。。。

* TOC
{:toc}


### 手撕SpringIoc容器
``` java
public class BeanContainer {

    private final Map<Class<?>, Object> singletons = new HashMap<>();
    private final Set<Class<?>> creating = new HashSet<>();

    public <T> T getBean(Class<T> type) {
        if (singletons.containsKey(type)) {
            return type.cast(singletons.get(type));
        }

        if (creating.contains(type)) {
            throw new IllegalStateException("Circular dependency: " + type);
        }

        creating.add(type);
        try {
            T instance = createBean(type);
            singletons.put(type, instance);
            return instance;
        } finally {
            creating.remove(type);
        }
    }

    private <T> T createBean(Class<T> type) {
        try {
            Constructor<?> ctor = selectConstructor(type);
            Object[] deps = resolveDependencies(ctor);
            ctor.setAccessible(true);
            return type.cast(ctor.newInstance(deps));
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    private Constructor<?> selectConstructor(Class<?> type) {
        Constructor<?>[] ctors = type.getDeclaredConstructors();
        if (ctors.length != 1) {
            throw new IllegalStateException("Only single constructor supported: " + type);
        }
        return ctors[0];
    }

    private Object[] resolveDependencies(Constructor<?> ctor) {
        Parameter[] params = ctor.getParameters();
        Object[] deps = new Object[params.length];
        for (int i = 0; i < params.length; i++) {
            deps[i] = getBean(params[i].getType());
        }
        return deps;
    }
}
```

### 手搓@UUID注解  
**implements BeanPostProcessor**
``` java
public class UUIDBeanPostProcessor implements BeanPostProcessor {
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        //拿到bean，得到class，
        if (bean instanceof BeanPostProcessor) {
            return bean;
        }
        Class cl = bean.getClass();
        Field[] fields = cl.getDeclaredFields();
        for (Field f : fields) {
            if (f.isAnnotationPresent(UUID.class)) {
                f.setAccessible(true);
                try {
                    f.set(bean, java.util.UUID.randomUUID().toString());
                } catch (IllegalAccessException e) {
                    throw new RuntimeException(e);
                }
            }
        }
        return bean;
    }
}

```